<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>HANBAO — 演示</title>
    <style>
      :root{
        --bg1:#a5f3fc; --bg2:#9ad6ff; --phone-w:390px;
        --icon-size:72px; --icon-radius:18px;
      }
      html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Noto Sans SC",Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));display:flex;align-items:center;justify-content:center}
      .phone{width:var(--phone-w);height:844px;border-radius:36px;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));box-shadow:0 40px 80px rgba(2,6,23,0.45);position:relative;overflow:hidden}
      /* wallpaper blur / glass effect */
      .wallpaper{position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.02));backdrop-filter:blur(6px);}
      .notch{position:absolute;left:50%;transform:translateX(-50%);top:6px;width:160px;height:36px;background:#0b0b0b;border-radius:12px 12px 8px 8px;z-index:5}
      .status{position:absolute;top:12px;left:18px;color:#fff;font-weight:600;z-index:6}
      .status-right{position:absolute;top:10px;right:14px;color:#fff;display:flex;gap:8px;align-items:center;z-index:6}
      .screen-content{position:relative;z-index:4;display:flex;flex-direction:column;height:100%;align-items:center}
      .clock{margin-top:110px;color:#fff;text-align:center;text-shadow:0 6px 18px rgba(0,0,0,0.35)}
      .clock .time{font-size:92px;font-weight:700;line-height:0.9}
      .clock .date{margin-top:8px;font-size:18px;color:rgba(255,255,255,0.9)}
      .app-row{margin-top:auto;margin-bottom:70px;display:flex;gap:28px;align-items:flex-end}
      .app{display:flex;flex-direction:column;align-items:center;color:#fff;text-decoration:none}
      .app .icon{width:var(--icon-size);height:var(--icon-size);border-radius:20px;background:#fff;display:flex;align-items:center;justify-content:center;color:#111;box-shadow:0 10px 30px rgba(10,20,30,0.25)}
      .app .label{margin-top:8px;font-size:13px;color:#0b1220}
      .dock{position:absolute;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(255,255,255,0.7);padding:10px 20px;border-radius:28px;box-shadow:0 12px 30px rgba(0,0,0,0.15)}
      /* screens */
      .hidden{display:none}
      /* chat styles */
      .chat{padding:18px;color:#0b1220}
      .messages{max-height:580px;overflow:auto;display:flex;flex-direction:column;gap:12px}
      .bubble{padding:10px 14px;border-radius:14px;background:#fff;max-width:78%;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
      .bubble.me{align-self:flex-end;background:linear-gradient(180deg,#34c759,#2ea84b);color:#fff}
      .input-row{display:flex;gap:8px;margin-top:12px}
      input[type=text]{flex:1;padding:10px;border-radius:18px;border:1px solid rgba(0,0,0,0.06)}
      button{padding:8px 12px;border-radius:12px;border:none;background:#0b84ff;color:#fff}
    </style>
  </head>
  <body>
    <div class="phone" role="application" aria-label="HANBAO Demo Phone">
      <div class="wallpaper"></div>
      <div class="notch" aria-hidden></div>
      <div class="status">18:33</div>
      <div class="status-right"><span>Wi‑Fi</span><span>🔋100%</span></div>

      <div class="screen-content">
        <div class="clock" id="home-clock">
          <div class="time" id="time">12:00</div>
          <div class="date" id="date">星期一, 1月1日</div>
        </div>

        <div class="app-row" id="app-row">
          <a class="app" href="#" data-screen="chat">
            <div class="icon">📚</div>
            <div class="label">世界书</div>
          </a>
          <a class="app" href="#" data-screen="settings">
            <div class="icon">⚙️</div>
            <div class="label">预设设置</div>
          </a>
          <a class="app" href="#" data-screen="chat">
            <div class="icon">👤</div>
            <div class="label">char入设</div>
          </a>
        </div>

        <div class="dock">HANBAO</div>
      </div>

      <!-- Chat screen -->
      <div id="chat-screen" class="hidden" style="position:absolute;inset:0;overflow:auto;background:linear-gradient(180deg,rgba(255,255,255,0.98),#fff)">
        <div style="padding:18px;display:flex;align-items:center;justify-content:space-between;background:transparent">
          <strong>AI 聊天</strong>
          <button id="homeBack">返回</button>
        </div>
        <div class="chat">
          <div id="messages" class="messages"><div class="bubble">你好，我是 AI 助手。</div></div>
          <div class="input-row"><input id="inputBox" type="text" placeholder="输入消息..." /><button id="sendBtn">发送</button></div>
        </div>
      </div>

      <!-- Settings screen -->
      <div id="settings-screen" class="hidden" style="position:absolute;inset:0;overflow:auto;background:white;padding:18px">
        <div style="display:flex;align-items:center;justify-content:space-between"><strong>API 设置</strong><button id="homeBack2">返回</button></div>
        <div style="margin-top:12px">
          <label>中转站地址</label>
          <input id="proxyUrl" placeholder="https://your-proxy.example.com" style="width:100%;padding:8px;border-radius:8px;border:1px solid #ddd" />
        </div>
        <div style="margin-top:8px">
          <label>API Key（测试）</label>
          <input id="apiKey" placeholder="sk-..." style="width:100%;padding:8px;border-radius:8px;border:1px solid #ddd" />
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="saveApiBtn">保存</button>
          <button id="testApiBtn">测试</button>
        </div>
        <div id="apiStatus" style="margin-top:8px;color:#666"></div>
      </div>
    </div>

    <script>
      // clock
      function updateClock(){ const d=new Date(); const hh=d.getHours().toString().padStart(2,'0'); const mm=d.getMinutes().toString().padStart(2,'0'); document.getElementById('time').innerText=hh+':'+mm; const dateStr = d.toLocaleDateString('zh-CN',{weekday:'long',month:'long',day:'numeric'}); document.getElementById('date').innerText = dateStr; }
      updateClock(); setInterval(updateClock,60000);

      // navigation
      document.querySelectorAll('[data-screen]').forEach(a=>a.addEventListener('click', e=>{ e.preventDefault(); const s=a.getAttribute('data-screen'); showScreen(s+'-screen'); }));
      function showScreen(id){ document.getElementById('chat-screen').classList.add('hidden'); document.getElementById('settings-screen').classList.add('hidden'); document.querySelector('.screen-content').style.display = id==='home' ? 'flex' : 'none'; if(document.getElementById(id)) document.getElementById(id).classList.remove('hidden'); }
      document.getElementById('homeBack').addEventListener('click',()=>{ document.getElementById('chat-screen').classList.add('hidden'); document.querySelector('.screen-content').style.display='flex'; });
      document.getElementById('homeBack2').addEventListener('click',()=>{ document.getElementById('settings-screen').classList.add('hidden'); document.querySelector('.screen-content').style.display='flex'; });

      // settings load/save
      function loadSettings(){ const s=JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); document.getElementById('proxyUrl').value=s.proxyUrl||''; document.getElementById('apiKey').value=s.apiKey||''; }
      function saveSettings(){ const s={proxyUrl:document.getElementById('proxyUrl').value.trim(),apiKey:document.getElementById('apiKey').value.trim()}; localStorage.setItem('hanbao-settings',JSON.stringify(s)); const st=document.getElementById('apiStatus'); st.innerText='已保存'; setTimeout(()=>st.innerText='',2000); }
      document.getElementById('saveApiBtn').addEventListener('click',saveSettings); loadSettings();

      // chat
  // core chat elements declared later inside chat block
      sendBtn.addEventListener('click',handleSend); inputBox.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); } });
      function appendMessage(text,who='you'){ const el=document.createElement('div'); el.className='bubble '+(who==='me'?'me':''); el.innerText=text; messagesEl.appendChild(el); messagesEl.scrollTop = messagesEl.scrollHeight; }
      async function handleSend(){ const txt=inputBox.value.trim(); if(!txt) return; appendMessage(txt,'me'); inputBox.value=''; appendMessage('正在生成回复...','you'); try{ const r=await callConfiguredAPI(txt); const last=messagesEl.querySelectorAll('.bubble'); if(last.length) last[last.length-1].remove(); appendMessage(r,'you'); }catch(e){ const last=messagesEl.querySelectorAll('.bubble'); if(last.length) last[last.length-1].remove(); appendMessage('请求失败：'+(e.message||e),'you'); } }

      async function callConfiguredAPI(userMessage){ const cfg=JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); if(cfg.proxyUrl){ const url=cfg.proxyUrl.replace(/\/$/,'')+'/v1/chat'; const res=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:cfg.model||'gpt-4o',message:userMessage})}); if(!res.ok) throw new Error('代理返回 '+res.status); const j=await res.json(); return j.reply||j.message||j.result||JSON.stringify(j); } if(cfg.apiKey){ const res=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+cfg.apiKey},body:JSON.stringify({model:cfg.model||'gpt-4o',messages:[{role:'user',content:userMessage}]})}); const j=await res.json(); return j.choices?.[0]?.message?.content||JSON.stringify(j); } return new Promise(r=>setTimeout(()=>r('本地模拟回复：'+userMessage.split('').reverse().join('')),700)); }

      document.getElementById('testApiBtn').addEventListener('click',async ()=>{ const s=JSON.parse(localStorage.getItem('hanbao-settings')||'{}'); const st=document.getElementById('apiStatus'); st.innerText='测试中...'; try{ if(s.proxyUrl){ const url=s.proxyUrl.replace(/\/$/,'')+'/v1/ping'; const r=await fetch(url); if(!r.ok) throw new Error('代理返回 '+r.status); st.innerText='代理可达'; } else st.innerText='请填写中转站地址'; }catch(e){ st.innerText='测试失败: '+(e.message||e); } setTimeout(()=>st.innerText='',3000); });
    </script>
  </body>
</html>
              <input id="model" placeholder="gpt-4o 或 text-bison" />
            </div>
            <div style="display: flex; gap: 8px">
              <button id="saveApiBtn" class="form-button">保存</button>
              <button id="testApiBtn" class="form-button" style="background: #06b6d4">测试</button>
            </div>
            <div id="apiStatus" class="note" style="padding-top: 6px"></div>
          </div>

          <footer>前端示例：不要在生产环境中将密钥放在前端。推荐使用服务器中转存储密钥。</footer>
        </div>
      </div>

      <script>
        // 屏幕切换
        function showScreen(id) {
          document
            .querySelectorAll('#home-screen,#chat-screen,#settings-screen')
            .forEach(s => s.classList.remove('active'));
          document.getElementById(id).classList.add('active');
        }
        document.getElementById('btnHome').addEventListener('click', () => showScreen('home-screen'));
        document.getElementById('btnChat').addEventListener('click', () => showScreen('chat-screen'));
        document.getElementById('btnSettings').addEventListener('click', () => showScreen('settings-screen'));
        document
          .querySelectorAll('[data-app="wechat"]')
          .forEach(el => el.addEventListener('click', () => showScreen('chat-screen')));
        document
          .querySelectorAll('[data-app="settings"]')
          .forEach(el => el.addEventListener('click', () => showScreen('settings-screen')));

        // 设置保存/加载（使用 hanbao-settings）
        function loadSettings() {
          const s = JSON.parse(localStorage.getItem('hanbao-settings') || '{}');
          document.getElementById('proxyUrl').value = s.proxyUrl || '';
          document.getElementById('apiKey').value = s.apiKey || '';
          document.getElementById('model').value = s.model || '';
        }
        function saveSettings() {
          const s = {
            proxyUrl: document.getElementById('proxyUrl').value.trim(),
            apiKey: document.getElementById('apiKey').value.trim(),
            model: document.getElementById('model').value.trim(),
          };
          localStorage.setItem('hanbao-settings', JSON.stringify(s));
          const status = document.getElementById('apiStatus');
          status.textContent = '设置已保存';
          setTimeout(() => (status.textContent = ''), 2200);
        }
        document.getElementById('saveApiBtn').addEventListener('click', saveSettings);
        loadSettings();

        // 聊天
        const messagesEl = document.getElementById('messages');
        const inputBox = document.getElementById('inputBox');
        const sendBtn = document.getElementById('sendBtn');

        function appendMessage(text, who = 'you') {
          const row = document.createElement('div');
          row.className = 'msg-row ' + (who === 'me' ? 'me' : 'you');
          const b = document.createElement('div');
          b.className = 'bubble ' + (who === 'me' ? 'me' : 'you');
          b.innerText = text;
          row.appendChild(b);
          messagesEl.appendChild(row);
          messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        sendBtn.addEventListener('click', handleSend);
        inputBox.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            handleSend();
          }
        });

        async function handleSend() {
          const text = inputBox.value.trim();
          if (!text) return;
          appendMessage(text, 'me');
          inputBox.value = '';
          appendMessage('正在生成回复...', 'you');
          try {
            const reply = await callConfiguredAPI(text);
            const last = messagesEl.querySelectorAll('.msg-row.you');
            if (last.length) last[last.length - 1].remove();
            appendMessage(reply, 'you');
          } catch (err) {
            console.error(err);
            const last = messagesEl.querySelectorAll('.msg-row.you');
            if (last.length) last[last.length - 1].remove();
            appendMessage('请求失败：' + (err.message || err), 'you');
          }
        }

        async function callConfiguredAPI(userMessage) {
          const cfg = JSON.parse(localStorage.getItem('hanbao-settings') || '{}');
          if (cfg.proxyUrl) {
            const url = cfg.proxyUrl.replace(/\/$/, '') + '/v1/chat';
            const res = await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ model: cfg.model || 'gpt-4o', message: userMessage }),
            });
            if (!res.ok) throw new Error('代理返回 ' + res.status);
            const d = await res.json();
            return d.reply || d.message || d.result || JSON.stringify(d);
          }
          if (cfg.apiKey) {
            try {
              const res = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + cfg.apiKey },
                body: JSON.stringify({
                  model: cfg.model || 'gpt-4o',
                  messages: [{ role: 'user', content: userMessage }],
                }),
              });
              const j = await res.json();
              return j.choices?.[0]?.message?.content || JSON.stringify(j);
            } catch (e) {
              throw e;
            }
          }
          return new Promise(r =>
            setTimeout(() => r('本地模拟回复：' + userMessage.split('').reverse().join('')), 700),
          );
        }

        document.getElementById('testApiBtn').addEventListener('click', async () => {
          const s = JSON.parse(localStorage.getItem('hanbao-settings') || '{}');
          const status = document.getElementById('apiStatus');
          status.textContent = '正在测试...';
          try {
            if (s.proxyUrl) {
              const url = s.proxyUrl.replace(/\/$/, '') + '/v1/ping';
              const r = await fetch(url);
              if (!r.ok) throw new Error('代理返回 ' + r.status);
              status.textContent = '代理可达';
            } else {
              status.textContent = '请填写中转站地址以测试';
            }
          } catch (e) {
            status.textContent = '测试失败: ' + (e.message || e);
          }
          setTimeout(() => (status.textContent = ''), 3000);
        });
      </script>
    </body>
  </html>
  <body></body>
</html>
